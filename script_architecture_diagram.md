# Layout Parser Script Architecture Diagram

## ğŸ“‹ **Overall Flow**

```
PDF Input â†’ Layout Detection â†’ Text Extraction â†’ Translation â†’ Image Generation
    â†“              â†“               â†“              â†“              â†“
sample.pdf â†’ Detectron2 Model â†’ OCR (Tesseract) â†’ DeepL API â†’ translated_layout.png
```

## ğŸ—ï¸ **Main Components Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           LAYOUT PARSER SCRIPT                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   INPUT LAYER   â”‚    â”‚ PROCESSING LAYERâ”‚    â”‚  OUTPUT LAYER   â”‚        â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚        â”‚
â”‚  â”‚ â€¢ PDF File      â”‚â”€â”€â”€â–¶â”‚ â€¢ Layout Model  â”‚â”€â”€â”€â–¶â”‚ â€¢ JSON Results  â”‚        â”‚
â”‚  â”‚ â€¢ Config        â”‚    â”‚ â€¢ OCR Engine    â”‚    â”‚ â€¢ Text File     â”‚        â”‚
â”‚  â”‚ â€¢ API Keys      â”‚    â”‚ â€¢ Translation   â”‚    â”‚ â€¢ Images        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ **Detailed Processing Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STEP-BY-STEP EXECUTION                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. INITIALIZATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ main()          â”‚
   â”‚ â€¢ Load model    â”‚
   â”‚ â€¢ Setup logging â”‚
   â”‚ â€¢ Validate PDF  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
2. PDF PROCESSING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚process_pdf_pagesâ”‚
   â”‚ â€¢ Convert to    â”‚
   â”‚   images        â”‚
   â”‚ â€¢ Extract stylesâ”‚
   â”‚ â€¢ Detect layout â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
3. LAYOUT DETECTION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Detectron2      â”‚
   â”‚ â€¢ Find blocks   â”‚
   â”‚ â€¢ Classify typesâ”‚
   â”‚ â€¢ Get coords    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
4. BLOCK PROCESSING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚merge_overlappingâ”‚
   â”‚split_multi_sect â”‚
   â”‚process_parallel â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
5. TEXT EXTRACTION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚extract_text_    â”‚
   â”‚from_block       â”‚
   â”‚ â€¢ OCR with      â”‚
   â”‚   Tesseract     â”‚
   â”‚ â€¢ Clean text    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
6. TRANSLATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚translate_text   â”‚
   â”‚ â€¢ DeepL API     â”‚
   â”‚ â€¢ Error handlingâ”‚
   â”‚ â€¢ Caching       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
7. IMAGE GENERATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚create_translatedâ”‚
   â”‚_image           â”‚
   â”‚ â€¢ Font sizing   â”‚
   â”‚ â€¢ Text layout   â”‚
   â”‚ â€¢ Styling       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
8. OUTPUT GENERATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Save Results    â”‚
   â”‚ â€¢ JSON file     â”‚
   â”‚ â€¢ Text file     â”‚
   â”‚ â€¢ PNG images    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© **Core Function Blocks**

### **1. Configuration & Setup**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONFIGURATION BLOCK                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ logging.basicConfig()                 â”‚
â”‚ â€¢ CACHE_DIR setup                       â”‚
â”‚ â€¢ Exception classes                     â”‚
â”‚ â€¢ @cache_result decorator               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. PDF Processing**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PDF PROCESSING BLOCK                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ convert_pdf_to_image()                â”‚
â”‚   â””â”€ pdf2image.convert_from_path()      â”‚
â”‚ â€¢ get_text_style()                      â”‚
â”‚   â””â”€ PyMuPDF font extraction            â”‚
â”‚ â€¢ validate_pdf()                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Layout Detection**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYOUT DETECTION BLOCK                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ lp.Detectron2LayoutModel()            â”‚
â”‚   â””â”€ PubLayNet model                    â”‚
â”‚ â€¢ Block types: Text, Title, List,       â”‚
â”‚   Table, Figure                         â”‚
â”‚ â€¢ Coordinate scaling                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4. Block Processing**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BLOCK PROCESSING BLOCK                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ merge_overlapping_blocks()            â”‚
â”‚   â””â”€ Combine related blocks             â”‚
â”‚ â€¢ split_multi_section_blocks()          â”‚
â”‚   â””â”€ Separate logical sections          â”‚
â”‚ â€¢ should_split_block()                  â”‚
â”‚   â””â”€ Detect multiple sections           â”‚
â”‚ â€¢ create_split_blocks()                 â”‚
â”‚   â””â”€ Create new block boundaries        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **5. OCR & Text Extraction**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OCR & TEXT EXTRACTION BLOCK             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ extract_text_from_block()             â”‚
â”‚   â”œâ”€ Image preprocessing                â”‚
â”‚   â”‚  â”œâ”€ CLAHE enhancement               â”‚
â”‚   â”‚  â”œâ”€ Adaptive thresholding           â”‚
â”‚   â”‚  â”œâ”€ Morphological operations        â”‚
â”‚   â”‚  â””â”€ Denoising                       â”‚
â”‚   â”œâ”€ Multiple OCR attempts              â”‚
â”‚   â”‚  â””â”€ Different PSM modes             â”‚
â”‚   â””â”€ Text scoring & selection           â”‚
â”‚ â€¢ optimize_image_for_ocr()              â”‚
â”‚ â€¢ clean_text()                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **6. Translation**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRANSLATION BLOCK                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ translate_text()                      â”‚
â”‚   â”œâ”€ Text chunking (4000 char limit)    â”‚
â”‚   â”œâ”€ DeepL API calls                    â”‚
â”‚   â”œâ”€ Error handling                     â”‚
â”‚   â””â”€ Result caching                     â”‚
â”‚ â€¢ @cache_result decorator               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **7. Font & Styling**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FONT & STYLING BLOCK                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ calculate_optimal_font_size_for_      â”‚
â”‚   filling()                             â”‚
â”‚   â”œâ”€ Test font sizes 14-46              â”‚
â”‚   â”œâ”€ Simulate text wrapping             â”‚
â”‚   â”œâ”€ Check height constraints           â”‚
â”‚   â””â”€ Find common denominator            â”‚
â”‚ â€¢ get_original_style_info()             â”‚
â”‚   â””â”€ Extract bold/italic flags          â”‚
â”‚ â€¢ get_font_set()                        â”‚
â”‚   â””â”€ Cross-platform font loading        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **8. Image Generation**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IMAGE GENERATION BLOCK                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ create_translated_image()             â”‚
â”‚   â”œâ”€ Create white background            â”‚
â”‚   â”œâ”€ Draw colored blocks                â”‚
â”‚   â”œâ”€ Calculate text positioning         â”‚
â”‚   â”œâ”€ Apply font styling                 â”‚
â”‚   â”œâ”€ Handle text alignment              â”‚
â”‚   â””â”€ Add block type labels              â”‚
â”‚ â€¢ Text wrapping algorithm               â”‚
â”‚ â€¢ Color schemes by block type           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ **Utility Functions**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UTILITY FUNCTIONS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ safe_ocr()                            â”‚
â”‚ â€¢ safe_translation()                    â”‚
â”‚ â€¢ safe_image_processing()               â”‚
â”‚ â€¢ is_similar_fuzzy()                    â”‚
â”‚ â€¢ extract_table_data()                  â”‚
â”‚ â€¢ extract_list_items()                  â”‚
â”‚ â€¢ validate_pdf()                        â”‚
â”‚ â€¢ validate_output_path()                â”‚
â”‚ â€¢ validate_image()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š **Data Flow Diagram**

```
INPUT DATA                 PROCESSING STAGES                OUTPUT DATA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚sample.  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚layout_  â”‚
â”‚pdf      â”‚               â”‚                 â”‚              â”‚results. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                 â”‚              â”‚json     â”‚
                          â”‚                 â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                 â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DeepL    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   MAIN SCRIPT   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚extractedâ”‚
â”‚API Key  â”‚               â”‚                 â”‚              â”‚_text.txtâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                 â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                 â”‚              
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                 â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Font     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚translatedâ”‚
â”‚Files    â”‚               â”‚                 â”‚              â”‚_layout. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚png      â”‚
                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                           â”‚layout_  â”‚
                                                           â”‚visualiz.â”‚
                                                           â”‚png      â”‚
                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ **Key Algorithms**

### **Block Splitting Algorithm**
```
1. Extract text from large block
2. Find section markers (INLOGGEGEVENS, SEPA, IBAN, etc.)
3. Calculate text positions
4. Split block coordinates proportionally
5. Assign appropriate block types
6. Store pre-extracted text
```

### **Font Sizing Algorithm**
```
1. For each block and text combination:
   a. Test font sizes from 14 to 46
   b. Simulate text wrapping
   c. Check if text fits in 95% of block height
   d. Record maximum working font size
2. Take minimum across all blocks (common denominator)
3. Ensure size is within 16-40 range
```

### **OCR Enhancement Algorithm**
```
1. Apply multiple preprocessing methods:
   - CLAHE contrast enhancement
   - Adaptive thresholding
   - Morphological operations
   - Denoising
2. Try different PSM modes (3,4,6,7,8)
3. Score results based on:
   - Text length
   - Recognizable patterns
   - Special character penalty
4. Select best result
```

## ğŸ§ª **Testing Framework**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TESTING BLOCK                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ TestLayoutParser class                â”‚
â”‚   â”œâ”€ test_image_optimization()          â”‚
â”‚   â”œâ”€ test_text_similarity()             â”‚
â”‚   â”œâ”€ test_table_extraction()            â”‚
â”‚   â”œâ”€ test_list_extraction()             â”‚
â”‚   â””â”€ test_pdf_validation()              â”‚
â”‚ â€¢ Temporary file creation               â”‚
â”‚ â€¢ Resource cleanup                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ **Performance Optimizations**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PERFORMANCE OPTIMIZATIONS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ @cache_result decorator               â”‚
â”‚   â””â”€ Disk-based caching with pickle    â”‚
â”‚ â€¢ concurrent.futures.ThreadPoolExecutorâ”‚
â”‚   â””â”€ Parallel block processing         â”‚
â”‚ â€¢ Multiple OCR attempts                 â”‚
â”‚   â””â”€ Best result selection             â”‚
â”‚ â€¢ Efficient text wrapping              â”‚
â”‚   â””â”€ Word-by-word calculation          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This diagram shows how the script is organized into logical blocks, with clear data flow and processing stages. Each component has a specific responsibility and they work together to transform a PDF into a translated, properly formatted layout. 